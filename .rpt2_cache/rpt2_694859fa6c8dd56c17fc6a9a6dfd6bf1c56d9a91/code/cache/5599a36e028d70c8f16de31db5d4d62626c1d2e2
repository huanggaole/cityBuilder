{
  "code": "import Map from \"../map/Map\";\r\nvar GameState;\r\n(function (GameState) {\r\n    GameState[GameState[\"CameraOperation\"] = 0] = \"CameraOperation\";\r\n    GameState[GameState[\"Construction\"] = 1] = \"Construction\";\r\n    GameState[GameState[\"Checking\"] = 2] = \"Checking\";\r\n})(GameState || (GameState = {}));\r\nexport default class GameUI extends Laya.Scene {\r\n    constructor() {\r\n        super();\r\n        this.mLastMouseX = 0;\r\n        this.mLastMouseY = 0;\r\n        this.lastDistance = 0;\r\n        this.mX = 0;\r\n        this.mY = 0;\r\n        console.log(\"地图初始化\");\r\n        GameUI.instance = this;\r\n        this.gamestate = GameState.CameraOperation;\r\n        this.createMap();\r\n    }\r\n    onEnable() {\r\n        this.cameraOper.on(Laya.Event.CLICK, this, this.onCameraOperClick);\r\n    }\r\n    createMap() {\r\n        this.tiledMap = new Map();\r\n        this.mX = 0;\r\n        this.mY = 0;\r\n        this.addChild(this.tiledMap);\r\n        this.tiledMap.x = 0;\r\n        this.tiledMap.y = 0;\r\n        Laya.stage.on(Laya.Event.MOUSE_DOWN, this, this.mouseDown);\r\n        Laya.stage.on(Laya.Event.MOUSE_UP, this, this.mouseUp);\r\n    }\r\n    mouseDown(e) {\r\n        if (this.gamestate == GameState.CameraOperation) {\r\n            var touches = e.touches;\r\n            this.mX = this.tiledMap.x / this.tiledMap.scaleX;\r\n            this.mY = this.tiledMap.y / this.tiledMap.scaleY;\r\n            if (touches && touches.length == 2) {\r\n                this.lastDistance = this.getDistance(touches);\r\n            }\r\n            else {\r\n                this.mLastMouseX = Laya.stage.mouseX;\r\n                this.mLastMouseY = Laya.stage.mouseY;\r\n            }\r\n            Laya.stage.on(Laya.Event.MOUSE_MOVE, this, this.mouseMove);\r\n        }\r\n    }\r\n    getDistance(points) {\r\n        var distance = 0;\r\n        if (points && points.length == 2) {\r\n            var dx = points[0].stageX - points[1].stageX;\r\n            var dy = points[0].stageY - points[1].stageY;\r\n            distance = Math.sqrt(dx * dx + dy * dy);\r\n        }\r\n        return distance;\r\n    }\r\n    mouseMove(e) {\r\n        if (this.gamestate == GameState.CameraOperation) {\r\n            var touches = e.touches;\r\n            if (touches && touches.length == 2) {\r\n                var distance = this.getDistance(e.touches);\r\n                const factor = 0.01;\r\n                this.tiledMap.scaleX += (distance - this.lastDistance) * factor;\r\n                this.tiledMap.scaleY += (distance - this.lastDistance) * factor;\r\n                this.tiledMap.x = this.mX * this.tiledMap.scaleX;\r\n                this.tiledMap.y = this.mY * this.tiledMap.scaleY;\r\n                this.lastDistance = distance;\r\n            }\r\n            else {\r\n                this.tiledMap.x = this.mX * this.tiledMap.scaleX - (this.mLastMouseX - Laya.stage.mouseX);\r\n                this.tiledMap.y = this.mY * this.tiledMap.scaleY - (this.mLastMouseY - Laya.stage.mouseY);\r\n            }\r\n        }\r\n    }\r\n    mouseUp(e) {\r\n        if (this.gamestate == GameState.CameraOperation) {\r\n            Laya.stage.off(Laya.Event.MOUSE_MOVE, this, this.mouseMove);\r\n        }\r\n    }\r\n    onCameraOperClick(e) {\r\n        this.gamestate = GameState.CameraOperation;\r\n        this.infolbl.text = \"移动缩放模式：单指操作进行地图移动，双指操作进行地图缩放。\";\r\n    }\r\n}\r\n",
  "references": [
    "C:/Users/huang/Documents/cityBuilder/src/map/Map.ts"
  ]
}
